<!doctype html>
<html lang="en">
    <head>
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Big Brain Blitz</title>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    </head>
    <body>
        <div class="container">
            <div class="row justify-content-center mt-2 d-none">
                <div x-row="10" class="gameCluePeg mx-1"></div>
                <div x-row="10" class="gameCluePeg mx-1"></div>
                <div x-row="10" class="gameCluePeg mx-1"></div>
                <div x-row="10" class="gameCluePeg mx-1"></div>
            </div>
            <div class="row justify-content-center mt-3">
                <div x-row="10" x-col="0" class="gameGuessPeg guess mx-3 my-2"></div>
                <div x-row="10" x-col="1" class="gameGuessPeg guess mx-3 my-2"></div>
                <div x-row="10" x-col="2" class="gameGuessPeg guess mx-3 my-2"></div>
                <div x-row="10" x-col="3" class="gameGuessPeg guess mx-3 my-2"></div>                
            </div>
            <div class="row justify-content-center">
                <div x-row="9" class="gameCluePeg mx-1"></div>
                <div x-row="9" class="gameCluePeg mx-1"></div>
                <div x-row="9" class="gameCluePeg mx-1"></div>
                <div x-row="9" class="gameCluePeg mx-1"></div>
            </div>
            <div class="row justify-content-center">
                <div x-row="9" x-col="0" class="gameGuessPeg guess mx-3 my-2"></div>
                <div x-row="9" x-col="1" class="gameGuessPeg guess mx-3 my-2"></div>
                <div x-row="9" x-col="2" class="gameGuessPeg guess mx-3 my-2"></div>
                <div x-row="9" x-col="3" class="gameGuessPeg guess mx-3 my-2"></div>                
            </div>
            <div class="row justify-content-center">
                <div x-row="8" class="gameCluePeg mx-1"></div>
                <div x-row="8" class="gameCluePeg mx-1"></div>
                <div x-row="8" class="gameCluePeg mx-1"></div>
                <div x-row="8" class="gameCluePeg mx-1"></div>
            </div>
            <div class="row justify-content-center">
                <div x-row="8" x-col="0" class="gameGuessPeg guess mx-3 my-2"></div>
                <div x-row="8" x-col="1" class="gameGuessPeg guess mx-3 my-2"></div>
                <div x-row="8" x-col="2" class="gameGuessPeg guess mx-3 my-2"></div>
                <div x-row="8" x-col="3" class="gameGuessPeg guess mx-3 my-2"></div>                
            </div>
            <div class="row justify-content-center">
                <div x-row="7" class="gameCluePeg mx-1"></div>
                <div x-row="7" class="gameCluePeg mx-1"></div>
                <div x-row="7" class="gameCluePeg mx-1"></div>
                <div x-row="7" class="gameCluePeg mx-1"></div>
            </div>
            <div class="row justify-content-center">
                <div x-row="7" x-col="0" class="gameGuessPeg guess mx-3 my-2"></div>
                <div x-row="7" x-col="1" class="gameGuessPeg guess mx-3 my-2"></div>
                <div x-row="7" x-col="2" class="gameGuessPeg guess mx-3 my-2"></div>
                <div x-row="7" x-col="3" class="gameGuessPeg guess mx-3 my-2"></div>                
            </div>
            <div class="row justify-content-center mt-2">
                <div x-row="6" class="gameCluePeg mx-1"></div>
                <div x-row="6" class="gameCluePeg mx-1"></div>
                <div x-row="6" class="gameCluePeg mx-1"></div>
                <div x-row="6" class="gameCluePeg mx-1"></div>
            </div>
            <div class="row justify-content-center">
                <div x-row="6" x-col="0" class="gameGuessPeg guess mx-3 my-2"></div>
                <div x-row="6" x-col="1" class="gameGuessPeg guess mx-3 my-2"></div>
                <div x-row="6" x-col="2" class="gameGuessPeg guess mx-3 my-2"></div>
                <div x-row="6" x-col="3" class="gameGuessPeg guess mx-3 my-2"></div>
            </div>
            <div class="row justify-content-center mt-2">
                <div x-row="5" class="gameCluePeg mx-1"></div>
                <div x-row="5" class="gameCluePeg mx-1"></div>
                <div x-row="5" class="gameCluePeg mx-1"></div>
                <div x-row="5" class="gameCluePeg mx-1"></div>
            </div>
            <div class="row justify-content-center">
                <div x-row="5" x-col="0" class="gameGuessPeg guess mx-3 my-2"></div>
                <div x-row="5" x-col="1" class="gameGuessPeg guess mx-3 my-2"></div>
                <div x-row="5" x-col="2" class="gameGuessPeg guess mx-3 my-2"></div>
                <div x-row="5" x-col="3" class="gameGuessPeg guess mx-3 my-2"></div>
            </div>
            <div class="row justify-content-center mt-2">
                <div x-row="4" class="gameCluePeg mx-1"></div>
                <div x-row="4" class="gameCluePeg mx-1"></div>
                <div x-row="4" class="gameCluePeg mx-1"></div>
                <div x-row="4" class="gameCluePeg mx-1"></div>
            </div>
            <div class="row justify-content-center">
                <div x-row="4" x-col="0" class="gameGuessPeg guess mx-3 my-2"></div>
                <div x-row="4" x-col="1" class="gameGuessPeg guess mx-3 my-2"></div>
                <div x-row="4" x-col="2" class="gameGuessPeg guess mx-3 my-2"></div>
                <div x-row="4" x-col="3" class="gameGuessPeg guess mx-3 my-2"></div>
            </div>
            <div class="row justify-content-center mt-2">
                <div x-row="3" class="gameCluePeg mx-1"></div>
                <div x-row="3" class="gameCluePeg mx-1"></div>
                <div x-row="3" class="gameCluePeg mx-1"></div>
                <div x-row="3" class="gameCluePeg mx-1"></div>
            </div>
            <div class="row justify-content-center">
                <div x-row="3" x-col="0" class="gameGuessPeg guess mx-3 my-2"></div>
                <div x-row="3" x-col="1" class="gameGuessPeg guess mx-3 my-2"></div>
                <div x-row="3" x-col="2" class="gameGuessPeg guess mx-3 my-2"></div>
                <div x-row="3" x-col="3" class="gameGuessPeg guess mx-3 my-2"></div>
            </div>
            <div class="row justify-content-center mt-2">
                <div x-row="2" class="gameCluePeg mx-1"></div>
                <div x-row="2" class="gameCluePeg mx-1"></div>
                <div x-row="2" class="gameCluePeg mx-1"></div>
                <div x-row="2" class="gameCluePeg mx-1"></div>
            </div>
            <div class="row justify-content-center">
                <div x-row="2" x-col="0" class="gameGuessPeg guess mx-3 my-2"></div>
                <div x-row="2" x-col="1" class="gameGuessPeg guess mx-3 my-2"></div>
                <div x-row="2" x-col="2" class="gameGuessPeg guess mx-3 my-2"></div>
                <div x-row="2" x-col="3" class="gameGuessPeg guess mx-3 my-2"></div>
            </div>
            <div class="row justify-content-center mt-2">
                <div x-row="1" class="gameCluePeg mx-1"></div>
                <div x-row="1" class="gameCluePeg mx-1"></div>
                <div x-row="1" class="gameCluePeg mx-1"></div>
                <div x-row="1" class="gameCluePeg mx-1"></div>
            </div>
            <div class="row justify-content-center">
                <div x-row="1" x-col="0" class="gameGuessPeg guess mx-3 my-2"></div>
                <div x-row="1" x-col="1" class="gameGuessPeg guess mx-3 my-2"></div>
                <div x-row="1" x-col="2" class="gameGuessPeg guess mx-3 my-2"></div>
                <div x-row="1" x-col="3" class="gameGuessPeg guess mx-3 my-2"></div>
            </div>
            <div class="row justify-content-center mt-2">
                <div x-row="0" class="gameCluePeg mx-1"></div>
                <div x-row="0" class="gameCluePeg mx-1"></div>
                <div x-row="0" class="gameCluePeg mx-1"></div>
                <div x-row="0" class="gameCluePeg mx-1"></div>
            </div>
            <div class="row justify-content-center">
                <div x-row="0" x-col="0" class="gameGuessPeg guess mx-3 my-2"></div>
                <div x-row="0" x-col="1" class="gameGuessPeg guess mx-3 my-2"></div>
                <div x-row="0" x-col="2" class="gameGuessPeg guess mx-3 my-2"></div>
                <div x-row="0" x-col="3" class="gameGuessPeg guess mx-3 my-2"></div>
            </div>
            <div class="row justify-content-center mt-1">
                <button id="submitGuess">Submit Current Guess</button>
            </div>
            <div class="row justify-content-center mt-1">
                <div x-row="0" x-col="0" x-color="red" class="colorPeg red colors mx-2 my-2"></div>
                <div x-row="0" x-col="1" x-color="green" class="colorPeg green colors mx-2 my-2"></div>
                <div x-row="0" x-col="2" x-color="blue" class="colorPeg blue colors mx-2 my-2"></div>
                <div x-row="0" x-col="2" x-color="yellow" class="colorPeg yellow colors mx-2 my-2"></div>
                <div x-row="0" x-col="2" x-color="white" class="colorPeg white colors mx-2 my-2"></div>
                <div x-row="0" x-col="2" x-color="black" class="colorPeg black colors mx-2 my-2"></div>
            </div>
            <div class="row justify-content-center mt-2">
                <hr class="w-50 solid">
            </div>
            <div class="row justify-content-center text-center">
                <h3>Big Brain Blitz</h3>
                <h6>William Edward Smith | CS50x 2024 Final Project</h6>
                <h6>ðŸ©· Created for Hannah "My-Boo-Boo-Bear" Smith ðŸ©·</h6>
                <h6>Inspired by 'MASTERMIND' owned by Invicta Plastics. For educational purposes only.</h6>
            </div>
            <div class="row justify-content-center mt-3">
                <hr class="w-50 solid">
            </div>
            <div class="row justify-content-center text-center mb-3">
                <h3>Settings and Options</h3>
            </div>
            <div class="row justify-content-center mt-1">
                <button id="chooseCode">Choose Code</button>
            </div>
            <div class="row justify-content-center my-3">
                <button id="resetGame">Reset Game</button>
            </div>
            <div class="row justify-content-center mt-4 mb-2">
                <hr class="w-50 solid">
            </div>
        </div>        
        <div class="modal fade" id="modalYesNo" tabindex="-1" aria-labelledby="modalYesNoLabel" aria-hidden="true" data-bs-keyboard="false" data-bs-backdrop="static">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                    <h5 class="modal-title" id="modalYesNoLabel">Please Select Yes or No</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="modalYesNoBody"></div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-success" data-bs-dismiss="modal" onclick="resetGame();">Yes</button>
                        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">No</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="modalOkClose" tabindex="-1" aria-labelledby="modalOkClose" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="modalOkCloseLabel">Game Message</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="modalOkCloseBody"></div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="modalCodeSelect" tabindex="-1" aria-labelledby="modalCodeSelect" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="modalCodeSelectLabel">Game Message</h5>
                        <button type="button" id="modalCloseSelectDismiss" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="modalCodeSelectBody">
                        <div class="row justify-content-center mt-1">
                            <div x-row="0" x-col="0" x-color="red" class="colorPeg red colors mx-2 my-2"></div>
                            <div x-row="0" x-col="1" x-color="green" class="colorPeg green colors mx-2 my-2"></div>
                            <div x-row="0" x-col="2" x-color="blue" class="colorPeg blue colors mx-2 my-2"></div>
                            <div x-row="0" x-col="2" x-color="yellow" class="colorPeg yellow colors mx-2 my-2"></div>
                            <div x-row="0" x-col="2" x-color="white" class="colorPeg white colors mx-2 my-2"></div>
                            <div x-row="0" x-col="2" x-color="black" class="colorPeg black colors mx-2 my-2"></div>
                        </div>
                        <div class="row justify-content-center mt-4 mb-2">
                            <hr class="w-50 solid">
                        </div>
                        <div class="row justify-content-center">
                            <div id="codeSelect1" x-row="-1" class="gameGuessPeg guess mx-3 my-2"></div>
                            <div id="codeSelect2" x-row="-1" class="gameGuessPeg guess mx-3 my-2"></div>
                            <div id="codeSelect3" x-row="-1" class="gameGuessPeg guess mx-3 my-2"></div>
                            <div id="codeSelect4" x-row="-1" class="gameGuessPeg guess mx-3 my-2"></div>
                        </div>
                        <div class="row justify-content-center mt-4 d-none text-danger" id="codeSelectFeedback">
                            Please make sure you select all the colors!
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" id="modalCodeSelectChoose" class="btn btn-primary">Choose Code</button>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>

<script>
    activeRow = 0;
    colors = ['red', 'green', 'blue', 'yellow', 'black', 'white'];
    code = [];
    $(document).ready(function() {
        localStorage.clear();
        generateNewCode();
        $('.guess').click(function(e) {
            if (localStorage.getItem('lastClickedColor')) {
                if ($(this).attr('x-row') == activeRow || $(this).attr('x-row') == -1) {
                    $(this).attr('x-color', localStorage.getItem('lastClickedColor'));
                    $(this).css('background-color', localStorage.getItem('lastClickedColor'));
                }
            }
        });
        $('.colorPeg').click(function() {
            localStorage.setItem('lastClickedColor', $(this).attr('x-color'));            
            $('.colorPeg').each((i, e) => {
                $(e).css('border-color','black');
            });
            $(this).css('border-color','orange');
        });
        $('#submitGuess').click(function(e) {
            evaluateGuess();
        });
        $('#resetGame').click(function(e) {
            $('#modalYesNoBody').html('Would you like to reset the game?');
            $('#modalYesNo').modal('show');
        });
        $('#chooseCode').click(function(e) {
            $('#codeSelectFeedback').addClass('d-none');
            $('#modalCodeSelect').modal('show');
        });
        $('#modalCodeSelectChoose').click(function(e) {
            if (
                   !$('#codeSelect1').attr('x-color')
                || !$('#codeSelect2').attr('x-color')
                || !$('#codeSelect3').attr('x-color')
                || !$('#codeSelect4').attr('x-color')
            ) {
                $('#codeSelectFeedback').removeClass('d-none');
                return;
            }
            tempCode = [];
            tempCode[0] = $('#codeSelect1').attr('x-color');
            tempCode[1] = $('#codeSelect2').attr('x-color');
            tempCode[2] = $('#codeSelect3').attr('x-color');
            tempCode[3] = $('#codeSelect4').attr('x-color');
            resetGame();
            code[0] = tempCode[0];
            code[1] = tempCode[1];
            code[2] = tempCode[2];
            code[3] = tempCode[3];
            console.log(code);
            $('#modalCodeSelect').modal('hide');
        });
        recolorPegs();
    });
    function recolorPegs() {
        $('.guess').each((i, e) => {
            if ($(e).attr('x-row') == activeRow || $(e).attr('x-row') == -1) {
                $(e).css('background-color', '#d4d6d5');
            }
            else if ($(e).attr('x-row') > activeRow) {
                $(e).css('background-color', 'gray');
            }
            $(e).removeAttr('x-color')
        });
    }
    function resetGame() {
        activeRow = 0;
        recolorPegs();
        $('.gameCluePeg').css('background-color', 'gray');
        generateNewCode();
        localStorage.removeItem('lastClickedColor');
        $('.colorPeg').each((i, e) => {
            $(e).css('border-color','black');
        });
    }
    function generateNewCode() {
        code.length = 0;
        for (let i = 0; i < 4; i++) {
            randomIndex = Math.floor(Math.random() * colors.length);
            selectedColor = colors[randomIndex];
            code.push(selectedColor);
        }
        console.log(code);
    }
    function evaluateGuess() {
        guesses = $('.guess[x-row=' + activeRow + ']');
        clues = $('.gameCluePeg[x-row=' + activeRow + ']');
        clueIndex = 0;
        correctCount = 0;
        hasPegCount = 0;
        
        $(guesses).each((i, e) => {
            if ($(e).attr('x-color')) {
                hasPegCount++
            }
        });

        if (hasPegCount < 4) {
            $('#modalOkCloseBody').html('Please select a color guess for all four slots.');
            $('#modalOkClose').modal('show');
            return;
        }

        for (let i = 0; i < 4; i++) {
            found = false;
            $(guesses).each((j, e) => {
                if (code[i] == $(e).attr('x-color') && i == j) {
                    found = true;
                }
            });
            if (found == true) {
                clues.eq(clueIndex).css('background-color','black');
                correctCount++;
                clueIndex++;
            }
            else {
                $(guesses).each((j, e) => {
                    if (code[i] == $(e).attr('x-color') && i != j) {
                        found = true;
                    }
                });
                if (found == true) {
                    clues.eq(clueIndex).css('background-color','white');
                    clueIndex++;
                }
            }
        }

        if (correctCount == 4) {
            $('#modalYesNoBody').html('You win! :)<br />The correct answer was: ' + code.join(', ').toProperCase() + '<br />Play again?');
            $('#modalYesNo').modal('show');
            return;
        }

        for (let i = clueIndex; i < 4; i++) {
            $(clues).eq(i).css('background-color','white');
            $(clues).eq(i).css('border-color','white');
        }       
        
        activeRow++;

        if (activeRow == 11) {
            $('#modalYesNoBody').html('I\'m sorry, you lose :(<br />The correct answer was: ' + code.join(', ').toProperCase() + '<br />Play again?');
            $('#modalYesNo').modal('show');
            return;
        }

        recolorPegs();
    }
    //Credit to Tuan @ https://stackoverflow.com/questions/196972/convert-string-to-title-case-with-javascript
    String.prototype.toProperCase = function () {
        return this.replace(/\w\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});
    };
</script>